<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>SQL support for GRASS</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
</head>

<!-- This file is lib/db/sqlp/description.html -->

<body bgcolor="white">

<H2>DESCRIPTION</H2>

SQL support for GRASS.
<P>
Supported is a limited set of SQL functions and operators.
<P>
<H2>FUNCTIONS</H2>
<PRE>
  ALTER TABLE table ADD [COLUMN] columndef
  CREATE TABLE table ( columndefs )
  DROP TABLE table
  SELECT columns FROM table
  SELECT columns FROM table WHERE condition
  DELETE FROM table
  DELETE FROM table WHERE condition
  INSERT INTO table VALUES (value1[,value2,...])
  INSERT INTO table ( column1[,column2,...] ) VALUES (value1[,value2,...])
  UPDATE table SET assignment1[,assignment2,...]
  UPDATE table SET assignment1[,assignment2,...] WHERE condition
</PRE>

<H2>OPERATORS</H2>
<PRE>
  "="  : equal
  "<"  : smaller than
  "<=" : smaller/equal than
  ">"  : larger than
  ">=" : larger/equal than
  "<>" : not equal
  "~"  : Substring matching
</PRE>

<p> Arithmetic expressions using constants and field values are allowed in condition clauses and in the RHS of assignments. Usual precedence rules and bracketing (using '(' and ')') are supported. Type conversion is performed if necessary (experimental). </p>
<p> Aggregate functions (sum, count, min, max,...) are NOT currently supported in SELECT clauses. </p>
<p> Mathematic functions (sin, cos, exp, log,...) are NOT currently supported in expressions. </p>
<p> Conditions allow boolean expressions using the AND, OR and NOT operators, with the usual precedence rules. </p>
<p> NULLs can be tested by 'colname IS NULL' in conditions. The negation is 'colname NOT NULL'.</p>

<H2>NOTES</H2>

<ul>
<li> SQL does not support '.' (dots) in table names.
<li> Supported table name characters are only:<br>
    [A-Za-z][A-Za-z0-9_]*
<li> A table name must start with a character, not a number.
<li> Text-string matching requires the text part to be 'single quoted' and
     multiple queries should be contained in "double quotes". e.g.<br>
	<pre>
      d.vect map where="individual='juvenile' and area='beach'"
	</pre>
<li> An error message such as "dbmi: Protocol error" either indicates an invalid column name
     or an unsupported column type (then the GRASS SQL parser needs to be extended).
<li> DBF column names are limited to 10 characters (DBF API definition)
</ul>

<h2>EXAMPLES</h2>

Display all vector points except for LAMAR valley and <i>extensive trapping</i> (brackets are superfluous in this example):
<pre>
 d.vect trapping_sites_points fcol=black icon=basic/diamond col=white size=13 \
    where="valley <> 'LAMAR' OR (valley = 'LAMAR' AND description = 'extensive trapping')"
</pre>
<p>
Select all attributes from table where str1 column values are not 'No Name':
<pre>
 echo "SELECT * FROM archsites WHERE str1 <> 'No Name'" | db.select
</pre>
<p>

<p>example of null handling:
<pre>v.db.addcol map=roads col='nulltest int'</pre>
<pre>v.db.update map=roads col=nulltest value=1 where='cat >2'</pre>
<pre>d.vect roads where='nulltest is null'</pre>
<pre>v.db.update map=roads col=nulltest value=2 where='cat <=2'</pre>
</p>

<p>examples of complex expressions in updates (using v.db.* modules):
<pre>v.db.addcol map=roads col='exprtest double'</pre>
<pre>v.db.update map=roads col=exprtest value=cat/nulltest</pre>
<pre>v.db.update map=roads col=exprtest value=cat/nulltest+cat where=cat=1</pre>
</p>

<p>examples of complex expressions in updates (using db.* modules):
<pre>echo "UPDATE roads SET exprtest=null"</pre>
<pre>echo "UPDATE roads SET exprtest=cat/2" | db.execute</pre>
<pre>echo "UPDATE roads SET exprtest=cat/2+cat/3" | db.execute</pre>
<pre>echo "UPDATE roads SET exprtest=NULL WHERE cat>2" | db.execute</pre>
<pre>echo "UPDATE roads SET exprtest=cat/3*(cat+1) WHERE exprtest IS NULL" | db.execute"</pre>
</p>


<p>You actually don't always have to create/update columns with expressions, but you can use them directly in other commands:
<pre>d.vect roads where='(cat/3*(cat+1))>8'</pre>
<pre>d.vect roads where='cat>exprtest'</pre>
</p>

<h2>SEE ALSO</h2>
<em>
<a HREF="db.execute.html">db.execute</a>,
<a HREF="db.select.html">db.select</a>,
<a HREF="db.tables.html">db.tables</a>,
<a HREF="d.vect.html">d.vect</a><BR>
<a HREF="http://grass.itc.it/grass57/tutorial/links.html">SQL reference links</a>
</em>


<p><i>Last changed: $Date$</i>
<HR>
<BR><a href=index.html>Help Index</a>
</body></html>
