#!/bin/sh

#generates HTML man page docs/html/index.html
#Markus Neteler, 2003

#exclude following list of modules from help index:
EXCLUDEHTML="v.topo.check"

############# nothing to configure below ############

#are we in the tools/ dir?
ls build_html_index.html 2> /dev/null
if [ $? -eq 1 ] ; then
 echo "ERROR: this script must be run from the tools/ directory"
 exit
fi

ARCH="`cat ../include/Make/Platform.make | grep ARCH | sed 's+ ++g' | cut -d'=' -f2`"
HTMLDIR="../dist.$ARCH/docs/html"

cd $HTMLDIR

echo "<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<TITLE>GRASS GIS 5.1 Reference Manual</TITLE>
<body bgcolor=\"#FFFFFF\">
<h2>GRASS GIS 5.1 Reference Manual</h2>
This reference manual details the use of modules distributed with
Geographic Resources Analysis Support System (GRASS), an open source (GNU
GPL'ed), image processing and geographic information system (GIS).
<p>
" > index.html

CMDLIST=`ls -1 *.html | grep -v index.html| cut -d'.' -f1 | sort -u`
CMDLISTNO=`echo $CMDLIST | wc -w | awk '{print $1}'`

echo "[ " >> index.html
k=0
for i in $CMDLIST
do
  k=$(( $k + 1 ))
  echo -n "<b><a href="#$i">$i.*</a></b>" >> index.html
  if [ $k -lt $CMDLISTNO ] ; then
     echo -n " | " >> index.html
  fi
done

echo " ]
<p>
<ul>" >> index.html

#for all module groups:
for i in $CMDLIST
do 
  echo "<a name="$i"></a>" >> index.html
  echo "<b>$i.* commands:</b>" >> index.html
  echo "<ul>" >> index.html

  #for all modules:  
  for i in `ls -1 $i.*.html | grep -v $EXCLUDEHTML`
  do
    BASENAME=`basename $i .html`
    echo "<li><a href=\"$i\">$BASENAME</a>" >> index.html
  done
  echo "</ul><br>" >> index.html
  echo "<p>" >> index.html
done

echo "</ul>" >> index.html
echo "<hr>" >> index.html
echo "&copy; 2003 <a href=\"http://grass.itc.it\">GRASS Development Team</a>" >> index.html
echo "</body>" >> index.html   
echo "</html>" >> index.html

echo "Generated $HTMLDIR/index.html"
echo "----------------------------------------------------------------------"
echo "Following modules are missing the 'description.html' file in src code:"
find . -name "*.html" | xargs fgrep --files-without-match 'DESCRIPTION' | grep -v './index.html'
echo "----------------------------------------------------------------------"
