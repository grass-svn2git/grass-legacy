# to force make to use /bin/sh
SHELL           = /bin/sh

#########################################################################
#                         Variable names
# xxxINCDIR  directory(ies) including header files (example: /usr/include)
# xxxINC  cc option(s) for include directory (example: -I/usr/inlude)
# xxxLIBDIR  directory(ies) containing library (example: /usr/lib)
# xxxLIBPATH cc option for library directory (example: -L/usr/lib)
# xxx_LIBNAME library name (example: gis)
# xxxLIB full static library path 
#        (example: /home/abc/grass51/dist.i686-pc-linux-gnu/lib/libgis.a)
# xxxDEP dependency
# 
# GRASS_xxx GRASS specific (without ARCH_xxx)
#
# ARCH_xxx platform specific dirs (without GRASS_xxx)
#
# _xxx  GRASS_xxx + ARCH_xxx
#
# ALLxxx all known for GRASS make system
#
#########################################################################

#generate static (ST) or shared (SH)
#LIB_PREFIX=$(STLIB_PREFIX)
#LIB_SUFFIX=$(STLIB_SUFFIX)
LIB_PREFIX=$(SHLIB_PREFIX)
LIB_SUFFIX=$(SHLIB_SUFFIX)


# GRASS global directories and constants
# platform specific dirs
ARCH_DISTDIR	= $(GRASS_HOME)/dist.$(ARCH)
ARCH_BINDIR     = $(GRASS_HOME)/bin.$(ARCH)

# include dirs
GRASS_INCDIR    = $(GRASS_HOME)/include
ARCH_INCDIR     = $(ARCH_DISTDIR)/include

GRASS_INC	= -I$(GRASS_INCDIR)
ARCH_INC	= -I$(ARCH_INCDIR)
INC		= $(GRASS_INC) $(ARCH_INC)
VECT_INC        = $(PQINCPATH)

# libraries
GRASS_LIBDIR    = $(GRASS_HOME)/lib
ARCH_LIBDIR     = $(ARCH_DISTDIR)/lib

ARCH_LIBPATH	= -L$(ARCH_LIBDIR)
LIBPATH		= $(ARCH_LIBPATH)

# object dir
OBJDIR		= OBJ.$(ARCH)

#########################################################################
# these define the various directories which contain GRASS programs
# or files used by GRASS programs
GISBASE		= $(ARCH_DISTDIR)
BIN             = $(ARCH_DISTDIR)/bin
ETC             = $(ARCH_DISTDIR)/etc
BIN_INTER       = $(ETC)/bin/inter
BIN_CMD         = $(ETC)/bin/cmd
DRIVERDIR       = $(ARCH_DISTDIR)/driver
DBDRIVERDIR     = $(ARCH_DISTDIR)/driver/db

FONTDIR         = $(ARCH_DISTDIR)/fonts

VERSION_MAJOR   = @VERSION_MAJOR@
VERSION_MINOR   = @VERSION_MINOR@
VERSION_RELEASE = @VERSION_RELEASE@
VERSION_DATE    = @VERSION_DATE@

VERSION_NUMBER  = $(VERSION_MAJOR).$(VERSION_MINOR).$(VERSION_RELEASE)
VERSION_NAME    = $(VERSION_MAJOR)$(VERSION_MINOR)$(VERSION_RELEASE)

VERSION_FILE    = $(ETC)/VERSION

##################### other #############################################
CFLAGS      =  $(COMPILE_FLAGS) $(INC) $(USE_TERMIO)
LDFLAGS     =  $(LINK_FLAGS) $(LIBPATH) $(USE_TERMIO) $(LINK_FLAGS)
VECT_CFLAGS =  $(GDALCFLAGS) 
##################### library names #####################################

BITMAP_LIBNAME   = grass_bitmap
BTREE_LIBNAME    = grass_btree
COORCNV_LIBNAME  = grass_coorcnv
DATETIME_LIBNAME = grass_datetime
DBDIALOG_LIBNAME = grass_dbdialog
DISPLAY_LIBNAME  = grass_display
DLG_LIBNAME      = grass_dlg
D__LIBNAME       = grass_D
DRIVER_LIBNAME   = grass_driver
EDIT_LIBNAME     = grass_edit
G3D_LIBNAME	 = grass_g3d
GIS_LIBNAME	 = grass_gis
GMATH_LIBNAME    = grass_gmath
GPROJ_LIBNAME    = grass_gproj
IBTREE_LIBNAME   = grass_ibtree
ICON_LIBNAME     = grass_icon
IMAGE_LIBNAME	 = grass_image
IMAGERY_LIBNAME  = grass_I
IORTHO_LIBNAME   = grass_Iortho
ISMAP_LIBNAME    = grass_ismap
LINKM_LIBNAME    = grass_linkm
LOCK_LIBNAME     = grass_lock
MANAGE_LIBNAME   = grass_manage
RASTER_LIBNAME   = grass_raster
ROWIO_LIBNAME    = grass_rowio
SEGMENT_LIBNAME  = grass_segment
VASK_LIBNAME	 = grass_vask
XGD_LIBNAME	 = grass_Xgd
XGI_LIBNAME	 = grass_Xgi
XPM_LIBNAME	 = grass_Xpm

# Vector
DIG_LIBNAME      = grass_dig
DIG2_LIBNAME     = grass_dig2
VECTR_LIBNAME    = grass_vect
TRANS_LIBNAME    = grass_trans

SHAPE_LIBNAME    = grass_shape
GRAPH_LIBNAME    = grass_dgl
RTREE_LIBNAME    = grass_rtree

# Interpolation
INTERPDATA_LIBNAME = grass_interpdata
INTERPFL_LIBNAME   = grass_interpfl
QTREE_LIBNAME      = grass_qtree

# NVIZ related
OGSF_LIBNAME       = grass_ogsf

# triangulation libraries
SOS_LIBNAME      = grass_sos
LIA_LIBNAME      = grass_lia
OPTRI_LIBNAME    = grass_optri
BASIC_LIBNAME    = grass_basic

XDISPLAY_LIBNAME = grass_Xdisplay

# DBMI
DBMI_LIBNAME     = grass_dbmi
DBMIBASE_LIBNAME     = grass_dbmibase
DBMICLIENT_LIBNAME   = grass_dbmiclient
DBMIDRIVER_LIBNAME   = grass_dbmidriver
SQLP_LIBNAME     = grass_sqlp
DBSTUBS_LIBNAME  = grass_dbstubs

# database forms
FORM_LIBNAME     = grass_form

# Symbols (icons, patterns)
SYMB_LIBNAME     = grass_symb

##################### library names and dependencies #################################
BITMAPLIB   = -l$(BITMAP_LIBNAME)
BITMAPDEP   = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(BITMAP_LIBNAME).$(LIB_SUFFIX)

BTREELIB    = -l$(BTREE_LIBNAME)
BTREEDEP    = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(BTREE_LIBNAME).$(LIB_SUFFIX)

COORCNVLIB  = -l$(COORCNV_LIBNAME)
COORCNVDEP  = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(COORCNV_LIBNAME).$(LIB_SUFFIX)

DATETIMELIB = -l$(DATETIME_LIBNAME)
DATETIMEDEP = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(DATETIME_LIBNAME).$(LIB_SUFFIX)

DBDIALOGLIB = -l$(DBDIALOG_LIBNAME)
DBDIALOGDEP = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(DBDIALOG_LIBNAME).$(LIB_SUFFIX)

DISPLAYLIB  = -l$(DISPLAY_LIBNAME)
DISPLAYDEP  = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(DISPLAY_LIBNAME).$(LIB_SUFFIX)

DLGLIB      = -l$(DLG_LIBNAME)
DLGDEP      = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(DLG_LIBNAME).$(LIB_SUFFIX)

D_LIB       = -l$(D__LIBNAME)
D_DEP       = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(D__LIBNAME).$(LIB_SUFFIX)

DRIVERLIB   = -l$(DRIVER_LIBNAME)
DRIVERDEP   = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(DRIVER_LIBNAME).$(LIB_SUFFIX)

EDITLIB     = -l$(EDIT_LIBNAME)
EDITDEP     = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(EDIT_LIBNAME).$(LIB_SUFFIX)

G3DLIB      = -l$(G3D_LIBNAME)
G3DDEP      = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(G3D_LIBNAME).$(LIB_SUFFIX)

GISLIB      = -l$(GIS_LIBNAME) $(DATETIMELIB) $(SOCKLIB) $(INTLLIB)
GISDEP      = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(GIS_LIBNAME).$(LIB_SUFFIX)

GMATHLIB    = -l$(GMATH_LIBNAME)
GMATHDEP    = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(GMATH_LIBNAME).$(LIB_SUFFIX)
#GMATHDEP: ?? $(FFTWLIB) $(LAPACKLIB) $(BLASLIB)

GPROJLIB    = -l$(GPROJ_LIBNAME) $(PROJLIB)
GPROJDEP    = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(GPROJ_LIBNAME).$(LIB_SUFFIX)

IBTREELIB   = -l$(IBTREE_LIBNAME)
IBTREEDEP   = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(IBTREE_LIBNAME).$(LIB_SUFFIX)

ICONLIB     = -l$(ICON_LIBNAME)
ICONDEP     = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(ICON_LIBNAME).$(LIB_SUFFIX)

IMAGELIB    = -l$(IMAGE_LIBNAME)
IMAGEDEP    = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(IMAGE_LIBNAME).$(LIB_SUFFIX)

IMAGERYLIB  = -l$(IMAGERY_LIBNAME)
IMAGERYDEP  = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(IMAGERY_LIBNAME).$(LIB_SUFFIX)

IORTHOLIB  = -l$(IORTHO_LIBNAME)
IORTHODEP  = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(IORTHO_LIBNAME).$(LIB_SUFFIX)

ISMAPLIB    = -l$(ISMAP_LIBNAME)
ISMAPDEP    = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(ISMAP_LIBNAME).$(LIB_SUFFIX)

LINKMLIB    = -l$(LINKM_LIBNAME)
LINKMDEP    = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(LINKM_LIBNAME).$(LIB_SUFFIX)

LOCKLIB     = -l$(LOCK_LIBNAME)
LOCKDEP     = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(LOCK_LIBNAME).$(LIB_SUFFIX)

MANAGELIB   = -l$(MANAGE_LIBNAME)
MANAGEDEP   = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(MANAGE_LIBNAME).$(LIB_SUFFIX)

RASTERLIB   = -l$(RASTER_LIBNAME)
RASTERDEP   = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(RASTER_LIBNAME).$(LIB_SUFFIX)

ROWIOLIB    = -l$(ROWIO_LIBNAME)
ROWIODEP    = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(ROWIO_LIBNAME).$(LIB_SUFFIX)

SEGMENTLIB  = -l$(SEGMENT_LIBNAME)
SEGMENTDEP  = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(SEGMENT_LIBNAME).$(LIB_SUFFIX)

VASKLIB     = -l$(VASK_LIBNAME)
VASKDEP     = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(VASK_LIBNAME).$(LIB_SUFFIX)

XGDLIB      = -l$(XGD_LIBNAME)
XGDDEP	    = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(XGD_LIBNAME).$(LIB_SUFFIX)

XGILIB      = -l$(XGI_LIBNAME)
XGIDEP	    = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(XGI_LIBNAME).$(LIB_SUFFIX)

XPMLIB      = -l$(XPM_LIBNAME)
XPMDEP	    = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(XPM_LIBNAME).$(LIB_SUFFIX)

# DBMI
DBMIBASELIB     = -l$(DBMIBASE_LIBNAME)
DBMIBASEDEP     = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(DBMIBASE_LIBNAME).$(LIB_SUFFIX)

DBMICLIENTLIB   = -l$(DBMICLIENT_LIBNAME)
DBMICLIENTDEP   = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(DBMICLIENT_LIBNAME).$(LIB_SUFFIX)

DBMIDRIVERLIB   = -l$(DBMIDRIVER_LIBNAME)
DBMIDRIVERDEP   = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(DBMIDRIVER_LIBNAME).$(LIB_SUFFIX)

DBMILIB         = $(DBMICLIENTLIB) $(DBMIBASELIB)
DBMIDEP         = $(DBMICLIENTDEP) $(DBMIBASEDEP)

SQLPLIB     = -l$(SQLP_LIBNAME)
SQLPDEP     = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(SQLP_LIBNAME).$(LIB_SUFFIX)

DBSTUBSLIB  = -l$(DBSTUBS_LIBNAME)
DBSTUBSDEP  = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(DBSTUBS_LIBNAME).$(LIB_SUFFIX)

# Vector
DIGLIB      = -l$(DIG_LIBNAME)
DIGDEP      = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(DIG_LIBNAME).$(LIB_SUFFIX)

DIG2LIB     = -l$(DIG2_LIBNAME)
DIG2DEP     = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(DIG2_LIBNAME).$(LIB_SUFFIX)

VECTRLIB    = -l$(VECTR_LIBNAME)
VECTRDEP    = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(VECTR_LIBNAME).$(LIB_SUFFIX)

TRANSLIB    = -l$(TRANS_LIBNAME)
TRANSDEP    = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(TRANS_LIBNAME).$(LIB_SUFFIX)

SHAPELIB    = -l$(SHAPE_LIBNAME)
SHAPEDEP    = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(SHAPE_LIBNAME).$(LIB_SUFFIX)

GRAPHLIB    = -l$(GRAPH_LIBNAME)
GRAPHDEP    = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(GRAPH_LIBNAME).$(LIB_SUFFIX)

RTREELIB    = -l$(RTREE_LIBNAME)
RTREEDEP    = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(RTREE_LIBNAME).$(LIB_SUFFIX)

VECTLIB     = $(VECTRLIB) $(DIG2LIB) $(SHAPELIB) $(GRAPHLIB) $(RTREELIB) $(LINKMLIB) $(DBMILIB) $(PQLIB)
VECTDEP     = $(VECTRDEP) $(DIG2DEP) $(SHAPEDEP) $(GRAPHDEP) $(RTREEDEP) $(LINKMDEP) $(DBMIDEP) 

# Interpolation
INTERPDATALIB = -l$(INTERPDATA_LIBNAME)
INTERPDATADEP = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(INTERPDATA_LIBNAME).$(LIB_SUFFIX)

INTERPFLLIB   = -l$(INTERPFL_LIBNAME)
INTERPFLDEP   = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(INTERPFL_LIBNAME).$(LIB_SUFFIX)

QTREELIB      = -l$(QTREE_LIBNAME)
QTREEDEP      = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(QTREE_LIBNAME).$(LIB_SUFFIX)

# NVIZ related
OGSFLIB      = -l$(OGSF_LIBNAME)
OGSFDEP      = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(OGSF_LIBNAME).$(LIB_SUFFIX)

# triangulation libraries
SOSLIB      = -l$(SOS_LIBNAME)
SOSDEP      = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(SOS_LIBNAME).$(LIB_SUFFIX)

LIALIB      = -l$(LIA_LIBNAME)
LIADEP      = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(LIA_LIBNAME).$(LIB_SUFFIX)

OPTRILIB    = -l$(OPTRI_LIBNAME)
OPTRIDEP    = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(OPTRI_LIBNAME).$(LIB_SUFFIX)

BASICLIB    = -l$(BASIC_LIBNAME)
BASICDEP    = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(BASIC_LIBNAME).$(LIB_SUFFIX)

GEOMLIB     = $(OPTRILIB) $(SOSLIB) $(LIALIB) $(BASICLIB)		
GEOMDEP     = $(OPTRIDEP) $(SOSDEP) $(LIADEP) $(BASICDEP)

# misc
XDISPLAYLIB = -l$(XDISPLAY_LIBNAME)
XDISPLAYDEP = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(XDISPLAY_LIBNAME).$(LIB_SUFFIX)

FORMLIB    = -l$(FORM_LIBNAME)
FORMDEP    = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(FORM_LIBNAME).$(LIB_SUFFIX)

SYMBLIB    = -l$(SYMB_LIBNAME)
SYMBDEP    = $(ARCH_LIBDIR)/$(LIB_PREFIX)$(SYMB_LIBNAME).$(LIB_SUFFIX)
##################### rules #############################################
# first found target
first: pre default

# create platform dirs 
pre: $(ARCH_BINDIR) $(ARCH_INCDIR) $(ARCH_LIBDIR) \
	$(BIN) $(ETC) $(BIN_CMD) $(BIN_INTER) \
	$(DRIVERDIR) $(DBDRIVERDIR) $(FONTDIR)
	
$(ARCH_BINDIR):
	mkdir -p $(ARCH_BINDIR)

$(ARCH_INCDIR):
	mkdir -p $(ARCH_INCDIR)

$(ARCH_LIBDIR):
	mkdir -p $(ARCH_LIBDIR)

$(BIN):
	mkdir -p $(BIN)

$(ETC):
	mkdir -p $(ETC)

$(BIN_CMD):
	mkdir -p $(BIN_CMD)

$(BIN_INTER):
	mkdir -p $(BIN_INTER)

$(DRIVERDIR):
	mkdir -p $(DRIVERDIR)

$(DBDRIVERDIR):
	mkdir -p $(DBDRIVERDIR)

$(FONTDIR):
	mkdir -p $(FONTDIR)

