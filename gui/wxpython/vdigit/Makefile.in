### DEFINITIONS

PYTHONVERSION=@PYVERSION@

### END DEFINITIONS

MODULE_TOPDIR = ../../..

include $(MODULE_TOPDIR)/include/Make/Lib.make

SWIG=swig

CXXFLAGS=-c -fpic -I$(ARCH_DISTDIR)/include  -I/usr/include/python$(PYTHONVERSION) `wx-config --cxxflags`

LDFLAGS=-shared -fpic -L$(ARCH_LIBDIR) $(VECTLIB) $(GISLIB) $(GDALLIBS) $(VEDITLIB) `wx-config --libs` -lgdi

LOCAL_HEADERS=digit.h driver.h
SOURCES=driver.cpp digit.cpp cats.cpp line.cpp vertex.cpp

OBJARCH=OBJ.$(ARCH)
OBJ := $(patsubst %.cpp, $(OBJARCH)/%.o, $(SOURCES))

default: grass6_wxvdigit.so

clean:
	-rm -rf $(OBJARCH) _grass6_wxvdigit.so grass6_wxvdigit_wrap.cxx grass6_wxvdigit.py grass6_wxvdigit.i grass6_wxvdigit.pyc	 

grass6_wxvdigit.i:
	cat ./digit.i > grass6_wxvdigit.i
	cat ./dig_types.i >> grass6_wxvdigit.i
	echo "/* auto-generate swig typedef file */" >> grass6_wxvdigit.i
	cat ./driver.h >> grass6_wxvdigit.i
	cat ./digit.h >> grass6_wxvdigit.i

grass6_wxvdigit_wrap.cxx: grass6_wxvdigit.i
	$(SWIG) -c++ -python -shadow $<

$(OBJARCH)/grass6_wxvdigit_wrap.o: grass6_wxvdigit_wrap.cxx $(OBJARCH)
	$(CXX) -c $(CXXFLAGS) $(INCLUDE_DIRS) $< -o $@

$(OBJARCH)/%.o: %.cpp $(LOCAL_HEADERS)
	$(CXX) -c $(CXXFLAGS) $(INCLUDE_DIRS) $< -o $@

grass6_wxvdigit.so: $(OBJARCH)/grass6_wxvdigit_wrap.o $(OBJ)
	$(CXX) $(LDFLAGS) $(OBJARCH)/grass6_wxvdigit_wrap.o $(OBJ) -o _grass6_wxvdigit.so
