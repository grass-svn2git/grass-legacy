<h2>DESCRIPTION</h2>

<b>i.atcorr</b> performs atmospheric correction on the input raster using the
6S algorithm (Second Simulation of Satellite Signal in the Solar Spectrum). A
detailed algorithm description is available at the 
<a href="http://modis-sr.ltdri.org/index.html">Land Surface Reflectance Science
Computing Facility website</a> and Mauro A. Homem Antunes <a
href="http://www.ltid.inpe.br/dsr/mauro/6s/download_6s.html">website about his
6s version</a>.

<p>
Current region settings are ignored. The region is adjusted to cover the input
raster before the atmospheric correction is performed. This should not affect
the user's current region settings.

<p>
Because using a continuous elevation <em>ialt</em> (input altitude map) or 
visibility <em>ivis</em> (input visibility map) map makes execution time much
longer, it is advised to use categorized maps instead, in conjuction with flag <em>-o</em>.
This flag tells <b>i.atcorr</b> to try and speedup calculations. However, this option
under certain conditions can make execution time longer.

<p>
If flag <em>-r</em> is used, the input data are treated as reflectance.
Otherwise, the input data are treated as radiance values and are converted to
reflectance at the <b>i.atcorr</b> runtime. The output data are always
reflectance.

<p>
An example 6s parameters <em>icnd</em> file for <b>i.atcorr</b>:

<p>
<div class="code"><pre>
8                            - geometrical conditions=Landsat ETM+
2 19 13.00 -47.410 -20.234   - month day hh.ddd longitude latitude ("hh.ddd" is a decimal hour GMT)
1                            - atmospheric mode=tropical
1                            - aerosols model=continental
15                           - visibility [km] (aerosol model concentration)
-.600                        - target at 600m above sea level
-1000                        - sensor on board a satellite
64                           - 4th band of ETM+ Landsat 7
</pre></div>

<h2><font color="red">REMAINING DOCUMENTATION ISSUES</font></h2>
1. Using the target elevation and visibility parameters in the <em>icnd</em>
file overrides <em>ialt</em> and <em>ivis</em> input rasters. It is not clear
what to do to force <b>i.atcorr</b> to use the rasters instead though.
<p>
2. The "example 6s parameters file" explains that "-.600" in line 6 means
"target at 600 m ASL". However, in the section E of "6S CODE PARAMETER CHOICES"
it reads: "xps &lt;=0. means the target is at the sea level". This is contrary.
<p>
3. In section E, I'm not sure if the "-100 &lt; xpp &lt; 0" shouldn't actually be
"-1000 &lt; xpp &lt; 0". ?
<p>
4. It should be explained under what circumstances the use of categorized maps
in conjuction with flag <em>-o</em> can slow down the calculations instead of
speeding them up.
<p>
5. "This should not affect the user's current region settings" sounds ambigious.
<p>

<H2>6S CODE PARAMETER CHOICES</H2>

<h3>A. Geometrical conditions:</h3>

<table CELLPADDING="3" border="1">

<tr>
<td>Code</td>
<td>Description</td>
<td>Details</td>
</tr>

<tr>
<td>1</td>
<td><b>meteosat</b> observation</td>
<td>enter month,day,decimal hour (universal time-hh.ddd)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
n. of column,n. of line.(full scale 5000*2500)&nbsp;</td>
</tr>

<tr>
<td>2</td>
<td><b>goes east </b>observation</td>
<td>enter month,day,decimal hour (universal time-hh.ddd)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
n. of column,n. of line.(full scale 17000*12000)c</td>
</tr>

<tr>
<td>3</td>
<td><b>goes west</b> observation</td>
<td>enter month,day,decimal hour (universal time-hh.ddd)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
n. of column,n. of line.(full scale 17000*12000)</td>
</tr>

<tr>
<td>4</td>
<td><b>avhrr</b> (PM noaa)</td>
<td>enter month,day,decimal hour (universal time-hh.ddd)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
n. of column(1-2048),xlonan,hna
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
give long.(xlonan) and overpass hour (hna) at
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
the ascendant node at equator</td>
</tr>

<tr>
<td>5</td>
<td><b>avhrr</b> (AM noaa)</td>
<td>enter month,day,decimal hour (universal time-hh.ddd)
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
n. of column(1-2048),xlonan,hna
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
give long.(xlonan) and overpass hour (hna) at
<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
the ascendant node at equator</td>
</tr>

<tr>
<td>6</td>
<td><b>hrv</b> (spot)</td>
<td>enter month,day,hh.ddd,long.,lat. *</td>
</tr>

<tr>
<td>7</td>
<td><b>tm</b> (landsat)</td>
<td>enter month,day,hh.ddd,long.,lat. *</td>
</tr>

<tr>
<td>8</td>
<td><b>etm+</b> (landsat7)</td>
<td>enter month,day,hh.ddd,long.,lat. *</td>
</tr>

<tr>
<td>9</td>
<td><b>liss</b> (IRS 1C)</td>
<td>enter month,day,hh.ddd,long.,lat. *</td>
</tr>
</table>

<blockquote>
* NOTE: for hrv, tm, etm+ and liss experiments, longitude and latitude
are the coordinates of the scene center. Latitude must be &gt;0 for northern
hemisphere and &lt;0 for southern. Longitude must be &gt;0 for eastern hemisphere
and &lt;0 for western.
</blockquote>

<br><h3>B. Atmospheric model</h3>

<table CELLPADDING="3" border="1">

<tr>
<td>Code</td>
<td>Meaning</td>
</tr>

<tr>
<td>0</td>
<td>no gaseous absorption</td>
</tr>

<tr>
<td>1</td>
<td>tropical</td>
</tr>

<tr>
<td>2</td>
<td>midlatitude summer</td>
</tr>

<tr>
<td>3</td>
<td>midlatitude winter</td>
</tr>

<tr>
<td>4</td>
<td>subarctic summer</td>
</tr>

<tr>
<td>5</td>
<td>subarctic winter</td>
</tr>

<tr>
<td>6</td>
<td>us standard 62</td>
</tr>

<tr>
<td>7</td>
<td>Define your own atmospheric model as a set of the following 5 parameters
per each measurement:<br>
<br>altitude [km]
<br>pressure [mb]
<br>temperature [k]
<br>h2o density [g/m3]
<br>o3 density [g/m3]<br>
<br>For example: there is one radiosonde measurement for each altitude of
0-25km at a step of 1km, one measurment for each altitude of 25-50km at a step
of 5km, and two single measurements for altitudes 70km and 100km. This makes 34
measurments. In that case, there are 34*5 values to input.</td>
</tr>

<tr>
<td>8</td>
<td>Define your own atmospheric model providing values of the water vapor and
ozone content:
<br>
<br>uw [g/cm2]
<br>uo3 [cm-atm]
<br>
<br> The profile is taken from us62.</td>
</tr>

</table>

<br><h3>C. Aerosols model</h3>

<table CELLPADDING="3" border="1">

<tr>
<td>Code</td>
<td>Meaning</td>
<td>Details</td>
</tr>

<tr>
<td>0</td>
<td>no aerosols</td>
<td></td>
</tr>

<tr>
<td>1</td>
<td>continental model</td>
<td></td>
</tr>

<tr>
<td>2</td>
<td>maritime model</td>
<td></td>
</tr>

<tr>
<td>3</td>
<td>urban model</td>
<td></td>
</tr>

<tr>
<td>4</td>
<td>shettle model for background desert aerosol</td>
<td></td>
</tr>

<tr>
<td>5</td>
<td>biomass burning</td>
<td></td>
</tr>

<tr>
<td>6</td>
<td>stratospheric model</td>
<td></td>
</tr>

<tr>
<td>7</td>
<td>define your own model</td>
<td>Enter the volumic percentage of each component:
<br>
<br>c(1) = volumic % of dust-like
<br>c(2) = volumic % of water-soluble
<br>c(3) = volumic % of oceanic
<br>c(4) = volumic % of soot
<br>
<br>All values between 0 and 1.</td>
</tr>

<tr>
<td>8</td>
<td>define your own model</td>
<td>Size distribution function: Multimodal Log Normal (up to 4 modes).</td>
</tr>

<tr>
<td>9</td>
<td>define your own model</td>
<td>Size distribution function: Modified gamma.</td>
</tr>

<tr>
<td>10</td>
<td>define your own model</td>
<td>Size distribution function: Junge Power-Law.</td>
</tr>

<tr>
<td>11</td>

<td>define your own model</td>

<td>Sun-photometer measurements, 50 values max, entered as:
<br>
<br>r and d V / d (logr)
<br>
<br>where r is the radius [micron], V is the volume, d V / d (logr) [cm3/cm2/micron].
<br>
<br>Followed by:
<br>
<br>nr and ni for each wavelength
<br>
<br>where nr and ni are respectively the real and imaginary part of the
refractive index.</td>
</tr>
</table>

<br><h3>D. Aerosol concentration model (visibility)</h3>

<blockquote>If you have an estimate of the meteorological parameter visibility
v, enter directly the value of v [km] (the aerosol optical depth will be
computed from a standard aerosol profile).
<p>If you have an estimate of aerosol optical depth, enter v=0 for the
visibility and enter the aerosol optical depth at 550nm (iaer means 'i' for input
and 'aer' for aerosol).
<p>NOTE: if iaer=0, enter v=-1.</blockquote>

<br><h3>E. Target altitude (xps), sensor platform (xpp)</h3>

<blockquote>xps &lt;=0 means the target is at the sea level.
<br>xps &gt;0 means you know the altitude of the target expressed
in km, and you put that value as xps.
<br>

<br>xpp=-1000 means that the sensor is on board a satellite.
<br>xpp=0 means that the sensor is at the ground level.
<br>-100&lt;xpp&lt;0 means you know the altitude of the sensor
expressed in kilometers; this altitude is <b>relative to the target</b>
altitude.

<p>For aircraft simulations only (xpp is neither 0 nor -1000):
<blockquote>
puw,po3 (water vapor content,ozone content between the aircraft and the surface)
<br>taerp (the aerosol optical thickness at 550nm between the aircraft and the
surface)
<p>If these data are not available, enter negative values for all of them.
puw,po3 will then be interpolated from the us62 standard profile according
to the values at the ground level. taerp will be computed according to a 2km
exponential profile for aerosol.</blockquote>
</blockquote>


<br><h3>F. Sensor band</h3>

<p>There are two possibilities: either define your own spectral conditions
(codes -2, -1, 0, or 1) or choose a code indicating the band of one of the
pre-defined satellites.

<p>Define your own spectral conditions:
<p>
<table CELLPADDING="3" border="1">

<tr>
<td>Code</td>
<td>Meaning</td>
</tr>

<tr>
<td>-2</td>
<td>Enter wlinf, wlsup.
<br>The filter function will be equal to 1 over the whole band (as iwave=0)
but step by step output will be printed.</td>
</tr>

<tr>
<td>-1</td>
<td>Enter wl (monochr. cond, gaseous absorption is included).</td>
</tr>

<tr>
<td>0</td>
<td>Enter wlinf, wlsup.
<br>The filter function will be equal to 1over the whole band.</td>
</tr>

<tr>
<td>1</td>
<td>Enter wlinf, wlsup and user's filter function s(lambda) by step of 0.0025
micrometer.</td>
</tr>
</table>

<p>Pre-defined satellite bands:
<p>
<table CELLPADDING="3" border="1">

<tr><td>Code</td><td>Meaning</td></tr>

<tr><td>2</td><td><b>meteosat</b> vis band (0.350-1.110)</td></tr>

<tr><td>3</td><td><b>goes east</b> band vis (0.490-0.900)</td></tr>
<tr><td>4</td><td>goes west band vis (0.490-0.900)</td></tr>

<tr><td>5</td><td><b>avhrr (noaa6)</b> band 1 (0.550-0.750)</td></tr>
<tr><td>6</td><td>avhrr (noaa6) band 2 (0.690-1.120)</td></tr>

<tr><td>7</td><td><b>avhrr (noaa7)</b> band 1 (0.500-0.800)</td></tr>
<tr><td>8</td><td>avhrr (noaa7) band 2 (0.640-1.170)</td></tr>

<tr><td>9</td><td><b>avhrr (noaa8)</b> band 1 (0.540-1.010)</td></tr>
<tr><td>10</td><td>avhrr (noaa8) band 2 (0.680-1.120)</td></tr>

<tr><td>11</td><td><b>avhrr (noaa9)</b> band 1 (0.530-0.810)</td></tr>
<tr><td>12</td><td>avhrr (noaa9) band 1 (0.680-1.170)</td></tr>

<tr><td>13</td><td><b>avhrr (noaa10)</b> band 1 (0.530-0.780)</td></tr>
<tr><td>14</td><td>avhrr (noaa10) band 2 (0.600-1.190)</td></tr>

<tr><td>15</td><td><b>avhrr (noaa11)</b> band 1 (0.540-0.820)</td></tr>
<tr><td>16</td><td>avhrr (noaa11) band 2 (0.600-1.120)</td></tr>

<tr><td>17</td><td><b>hrv1 (spot1)</b> band 1 (0.470-0.650)</td></tr>
<tr><td>18</td><td>hrv1 (spot1) band 2 (0.600-0.720)</td></tr>
<tr><td>19</td><td>hrv1 (spot1) band 3 (0.730-0.930)</td></tr>
<tr><td>20</td><td>hrv1 (spot1) band pan (0.470-0.790)</td></tr>

<tr><td>21</td><td><b>hrv2 (spot1)</b> band 1 (0.470-0.650)</td></tr>
<tr><td>22</td><td>hrv2 (spot1) band 2 (0.590-0.730)</td></tr>
<tr><td>23</td><td>hrv2 (spot1) band 3 (0.740-0.940)</td></tr>
<tr><td>24</td><td>hrv2 (spot1) band pan (0.470-0.790)</td></tr>

<tr><td>25</td><td><b>tm (landsat5)</b> band 1 (0.430-0.560)</td></tr>
<tr><td>26</td><td>tm (landsat5) band 2 (0.500-0.650)</td></tr>
<tr><td>27</td><td>tm (landsat5) band 3 (0.580-0.740)</td></tr>
<tr><td>28</td><td>tm (landsat5) band 4 (0.730-0.950)</td></tr>
<tr><td>29</td><td>tm (landsat5) band 5 (1.5025-1.890)</td></tr>
<tr><td>30</td><td>tm (landsat5) band 7 (1.950-2.410)</td></tr>

<tr><td>31</td><td><b>mss (landsat5)</b> band 1 (0.475-0.640)</td></tr>
<tr><td>32</td><td>mss (landsat5) band 2 (0.580-0.750)</td></tr>
<tr><td>33</td><td>mss (landsat5) band 3 (0.655-0.855)</td></tr>
<tr><td>34</td><td>mss (landsat5) band 4 (0.785-1.100)</td></tr>

<tr><td>35</td><td><b>MAS (ER2)</b> band 1 (0.5025-0.5875)</td></tr>
<tr><td>36</td><td>MAS (ER2) band 2 (0.6075-0.7000)</td></tr>
<tr><td>37</td><td>MAS (ER2) band 3 (0.8300-0.9125)</td></tr>
<tr><td>38</td><td>MAS (ER2) band 4 (0.9000-0.9975)</td></tr>
<tr><td>39</td><td>MAS (ER2) band 5 (1.8200-1.9575)</td></tr>
<tr><td>40</td><td>MAS (ER2) band 6 (2.0950-2.1925)</td></tr>
<tr><td>41</td><td>MAS (ER2) band 7 (3.5800-3.8700)</td></tr>

<tr><td>42</td><td><b>MODIS</b> band 1 (0.6100-0.6850)</td></tr>
<tr><td>43</td><td>MODIS band 2 (0.8200-0.9025)</td></tr>
<tr><td>44</td><td>MODIS band 3 (0.4500-0.4825)</td></tr>
<tr><td>45</td><td>MODIS band 4 (0.5400-0.5700)</td></tr>
<tr><td>46</td><td>MODIS band 5 (1.2150-1.2700)</td></tr>
<tr><td>47</td><td>MODIS band 6 (1.6000-1.6650)</td></tr>
<tr><td>48</td><td>MODIS band 7 (2.0575-2.1825)</td></tr>

<tr><td>49</td><td><b>avhrr (noaa12)</b> band 1 (0.500-1.000)</td></tr>
<tr><td>50</td><td>avhrr (noaa12) band 2 (0.650-1.120)</td></tr>

<tr><td>51</td><td><b>avhrr (noaa14)</b> band 1 (0.500-1.110)</td></tr>
<tr><td>52</td><td>avhrr (noaa14) band 2 (0.680-1.100)</td></tr>

<tr><td>53</td><td><b>POLDER</b> band 1 (0.4125-0.4775)</td></tr>
<tr><td>54</td><td>POLDER band 2 (non polar) (0.4100-0.5225)</td></tr>
<tr><td>55</td><td>POLDER band 3 (non polar) (0.5325-0.5950)</td></tr>
<tr><td>56</td><td>POLDER band 4 P1 (0.6300-0.7025)</td></tr>
<tr><td>57</td><td>POLDER band 5 (non polar) (0.7450-0.7800)</td></tr>
<tr><td>58</td><td>POLDER band 6 (non polar) (0.7000-0.8300)</td></tr>
<tr><td>59</td><td>POLDER band 7 P1 (0.8100-0.9200)</td></tr>
<tr><td>60</td><td>POLDER band 8 (non polar) (0.8650-0.9400)</td></tr>

<tr><td>61</td><td><b>etm+ (landsat7)</b> band 1 (0.435-0.520)</td></tr>
<tr><td>62</td><td>etm+ (landsat7) band 2 (0.506-0.621)</td></tr>
<tr><td>63</td><td>etm+ (landsat7) band 3 (0.622-0.702)</td></tr>
<tr><td>64</td><td>etm+ (landsat7) band 4 (0.751-0.911)</td></tr>
<tr><td>65</td><td>etm+ (landsat7) band 5 (1.512-1.792)</td></tr>
<tr><td>66</td><td>etm+ (landsat7) band 7 (2.020-2.380)</td></tr>
<tr><td>67</td><td>etm+ (landsat7) band 8 (0.504-0.909)</td></tr>

</table>

<h2>EXAMPLES</h2>

North Carolina sample dataset: Atmospheric correction of a LANDSAT-7 channel:

<div class="code"><pre>
g.region rast=lsat7_2002_40 -p
r.info lsat7_2002_40

# using an integer DEM greatly accelerates the i.atcorr computations
r.mapcalc "elev_int = round(elevation)"

# find mean elevation (target above sea level)
r.univar elev_int

# create control file for channel 4 (NIR)
echo "8                            - geometrical conditions=Landsat ETM+
5 24 14.30 -78.691 35.749    - month day hh.ddd longitude latitude ("hh.ddd" is a decimal hour GMT)
2                            - atmospheric mode=midlatitude summer
1                            - aerosols model=continental
50                           - visibility [km] (aerosol model concentration)
-.110                        - target at 110m above sea level
-1000                        - sensor on board a satellite
64                           - 1th band of ETM+ Landsat 7" > icnd.txt

# run atmospheric correction
i.atcorr lsat7_2002_40 ialt=elev_int icnd=icnd.txt oimg=lsat7_2002_40_atcorr
</pre></div>

Note that the process is computationally intensive.

<H2>AUTHORS</H2>

<p><em>Original version of the program for GRASS 5:</em>
<br>Christo Zietsman, 13422863(at)sun.ac.za

<p><em>Code clean-up and port to GRASS 6.3, 15.12.2006:</em>
<br>Yann Chemin, ychemin(at)gmail.com

<h2>REFERENCES</h2>

<p>Vermote, E.F., Tanre, D., Deuze, J.L., Herman, M., and Morcrette, J.J., 1997,
Second simulation of the satellite signal in the solar spectrum, 6S: An
overview., IEEE Trans. Geosc. and Remote Sens. 35(3):675-686.

<p><a href="http://modis-sr.ltdri.org/6S_code/6S_code2_thinner_stuff/6S_ltdri_org_manual.html">6s manual</a> at the <a href="http://modis-sr.ltdri.org/6S_code/index.html">6s homepage</a> of the Land Surface Reflectance Science Computing Facility (also <a href="www.rsgis.ait.ac.th/~honda/textbooks/advrs/6smanv2.0_P1.pdf">PDF1</a>, <a href="www.rsgis.ait.ac.th/~honda/textbooks/advrs/6smanv2.0_P2.pdf">PDF2</a>, and <a href="www.rsgis.ait.ac.th/~honda/textbooks/advrs/6smanv2.0_P3.pdf">PDF3</a>)

<p>Mauro A. Homem Antunes <a href="http://www.ltid.inpe.br/dsr/mauro/6s/download_6s.html">website about his 6s version</a>

<p><i>Last changed: $Date$</i>

