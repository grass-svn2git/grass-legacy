<h2>DESCRIPTION</h2>

<p>The module fills a lake at given level from given start point. The user
can think of it as <em>r.grow</em> with additional checks.  The resulting
raster map contains cells with positive values below water level
representing lake depth and NULL for other territories.</p>

<p>This module uses a 3x3 moving window approach to find all cells that
match three criteria and thus belong to the lake:

<ul>
 <li>are below given elevation (water level);</li>
 <li>are connected with initial cell (seed or E,N value);</li>
 <li>are not null or masked.</li>
</ul>
</p>

<p>Water level must be in DEM units.</p>

<p>As seed (starting) point can be used raster map with at least one
cell with value larger than zero or seed point can be specified as E,
N value pair. If seed is specified as coordinate pair, additional
check that given water level is above DEM is done. In case of seed map,
no such checks are done and thus specifying water level below earth
surface represented by DEM will result in an empty map. Seed map can be
also in previous run created lake map.</p>

<p>The module output goes to new map (<em>lake=foo</em>) or replaces input
(<em>seed=bar</em>) map if <em>-o</em> flag is used.  The user can use
<em>-o</em> flag to create animations with rising water level without
need of separate map for each frame.  An initial seed map must be created and
will be overwritten during the next run with next water levels map (uses single
file for input and output).</p>

<p>Negative output is useful for visualisations in NVIZ. It equals
mapcalc's expression <em>"negative = 0 - positive"</em>.</p>

<h2>KNOWN BUGS AND LIMITATIONS</h2>

<ul>
  <li>Whole map is loaded into RAM.</li>
  <li>Module is NOT large file safe. (due to previous point)</li>
  <li>Negative seed maps will not work! Output of <em>r.lake -n</em>
	can NOT be used as input in next run.</li>
</ul>

<h2>MAPCALC EQUIVALENT - FOR GRASS HACKERS</h2>

<p>This module was initially made as script using
<em>r.mapcalc</em>. That had some limitations - it was slow and no
checks where done to find out required iteration count. This shell code
for <em>r.mapcalc</em> is shown below:

<div class="code"><pre>
${seedmap} = if( ${dem}, \
if( if( isnull(${seedmap}),0,${seedmap}>0), ${wlevel}-${dem}, \
 if( \
  if(isnull(${seedmap}[-1,0]),0, ${seedmap}[-1,0]>0 && ${wlevel}>${dem}) ||\
  if(isnull(${seedmap}[-1,1]),0, ${seedmap}[-1,1]>0 && ${wlevel}>${dem}) ||\
  if(isnull(${seedmap}[0,1]), 0, ${seedmap}[0,1]>0  && ${wlevel}>${dem}) ||\
  if(isnull(${seedmap}[1,1]), 0, ${seedmap}[1,1]>0  && ${wlevel}>${dem}) ||\
  if(isnull(${seedmap}[1,0]), 0, ${seedmap}[1,0]>0  && ${wlevel}>${dem}) ||\
  if(isnull(${seedmap}[1,-1]),0, ${seedmap}[1,-1]>0 && ${wlevel}>${dem}) ||\
  if(isnull(${seedmap}[0,-1]),0, ${seedmap}[0,-1]>0 && ${wlevel}>${dem}) ||\
  if(isnull(${seedmap}[-1,-1]),0, ${seedmap}[-1,-1]>0 && ${wlevel}>${dem}),\
 ${wlevel}-${dem}, null() )))
</pre></div>

The ${seedmap} is replaced with seed maps name, ${dem} with DEM map name and
${wlevel} with target water level.  To get single water level, this code block is
called with same level plethora times (in loop) as the lake grows by single cell
during single run.</p>

<h2>SEE ALSO</h2>

<em><a href="r.mapcalc.html">r.mapcalc</a>,
<a href="r.grow.html">r.grow</a>,
<a href="r.plane.html">r.plane</a></em>

<h2>AUTHOR</h2>
Maris Nartiss (maris.nartiss gmail.com)

<p><i>Last changed: $Date$</i></p>
