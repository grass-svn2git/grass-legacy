<H2>DESCRIPTION</H2>


<EM>r.drain</EM> traces a flow through a least-cost path in an elevation
model. The <EM>elevation</EM> surface (a raster map layer input) might be
the cumulative cost map generated by the <EM><A
HREF="r.cost.html">r.cost</A></EM> program.

The <EM>output</EM> result (also a raster map layer) will show one or more 
least-cost paths between each user-provided location(s) and the low spot 
(low category values) in the input model. By default, the output will be an
integer cell map with <EM>1</EM> along the least cost path, and null cells
elsewhere.

<P>
With the <B>-c</B> (<EM>copy</EM>) flag, the input map cells values are
copied verbatim along the path. With the <B>-a</B> (<EM>accumulate</EM>)
flag, the accumulated cells value from the starting point up to the current
cell is written on output. With the <B>-c</B> and the <B>-a</B> flags, the
output map is created withe the same cell type than the input map (integer,
float or double). The <B>-c</B> and <B>-a</B> flags are mutually
incompatible. If both are specified, the <B>-a</B> flag will superceed the
<B>-c</B> flag, and a warning message will be issued.  With the <B>-n</B>
(<EM>number</EM>) flag, the cells are numbered from the starting point to
the final point.

<P>
The path is calculated by choosing the stepper "slope" between adjacent
cells. The slope calculation accurately acounts for the variable scale in
lat-lon projections.

<P>
The <B>coordinate</B> parameter consists of map E and N grid coordinates of
a starting point. Each x,y pair is the easting and northing (respectively) of 
a starting point from which a least-cost corridor will be developed. 
As many points as desired can be input.
(But, see BUGS below.) 

<P>
The <B>vector_points</B> parameter are two vector maps containing starting
point(s) and stop point(s). To calculate the least-cost path from two points 
stored in a single map, this map name has to be specified twice.

<H2>EXAMPLES</H2>

Consider the following example: 

<PRE>
Input:                          Output:
  ELEVATION SURFACE               LEAST COST PATH
. . ----- . . . . . . . . . .    . . . . . . . . . . . . . . .
. 20| 19| 17. 16. 17. 16. 16.    .   . 1 . 1 . 1 .   .   .   .
. . |___| . . . . . . . . . .    . . . . . . . . . . . . . . .
. 18. 18. 24. 18. 15. 12. 11.    .   .   .   .   . 1 .   .   .
. . . . . . . . . . . . . . .    . . . . . . . . . . . . . . .
. 22. 16. 16. 18. 10. 10. 10.    .   .   .   .   . 1 .   .   .
. . . . . . . . . . . . . . .    . . . . . . . . . . . . . . .
. 17. 15. 15. 15. 10. 8 . 8 .    .   .   .   .   .   . 1 .   .
. . . . . . . . . . . . . . .    . . . . . . . . . . . . . . .
. 24. 16. 8 . 7 . 8 . 0 .12 .    .   .   .   .   .   . 1 .   .
. . . . . . . . . . . . . . .    . . . . . . . . . . . . . . .
. 17. 9 . 8 . 7 . 8 . 6 .12 .    .   .   .   .   .   .   .   .
. . . . . . . . . . . . . . .    . . . . . . . . . . . . . . .
</PRE>

<P>

The user-provided starting location in the above example is 
the boxed <B>19</B> in the left-hand map. The path in the output 
shows the least-cost corridor for moving from the starting 
box to the lowest (smallest) possible point. This is the path a raindrop 
would take in this landscape.
<P>

With the <B>-c</B> <EM>(copy)</EM> flag, you get the following result:
<PRE>
Input:                          Output:
  ELEVATION SURFACE               LEAST COST PATH
. . ----- . . . . . . . . . .    . . . . . . . . . . . . . . .
. 20| 19| 17. 16. 17. 16. 16.    .   . 19. 17. 16.   .   .   .
. . |___| . . . . . . . . . .    . . . . . . . . . . . . . . .
. 18. 18. 24. 18. 15. 12. 11.    .   .   .   .   . 15.   .   .
. . . . . . . . . . . . . . .    . . . . . . . . . . . . . . .
. 22. 16. 16. 18. 10. 10. 10.    .   .   .   .   . 10.   .   .
. . . . . . . . . . . . . . .    . . . . . . . . . . . . . . .
. 17. 15. 15. 15. 10. 8 . 8 .    .   .   .   .   .   . 8 .   .
. . . . . . . . . . . . . . .    . . . . . . . . . . . . . . .
. 24. 16. 8 . 7 . 8 . 0 .12 .    .   .   .   .   .   . 0 .   .
. . . . . . . . . . . . . . .    . . . . . . . . . . . . . . .
. 17. 9 . 8 . 7 . 8 . 6 .12 .    .   .   .   .   .   .   .   .
. . . . . . . . . . . . . . .    . . . . . . . . . . . . . . .
<P>
Note that the last <EM>0</EM> will not be put in the null values map.
</PRE>

<P>

With the <B>-a</B> <EM>(accumulate)</EM> flag, you get the following result:
<PRE>
Input:                          Output:
  ELEVATION SURFACE               LEAST COST PATH
. . ----- . . . . . . . . . .    . . . . . . . . . . . . . . .
. 20| 19| 17. 16. 17. 16. 16.    .   . 19. 28. 44.   .   .   .
. . |___| . . . . . . . . . .    . . . . . . . . . . . . . . .
. 18. 18. 24. 18. 15. 12. 11.    .   .   .   .   . 59.   .   .
. . . . . . . . . . . . . . .    . . . . . . . . . . . . . . .
. 22. 16. 16. 18. 10. 10. 10.    .   .   .   .   . 69.   .   .
. . . . . . . . . . . . . . .    . . . . . . . . . . . . . . .
. 17. 15. 15. 15. 10. 8 . 8 .    .   .   .   .   .   . 77.   .
. . . . . . . . . . . . . . .    . . . . . . . . . . . . . . .
. 24. 16. 8 . 7 . 8 . 0 .12 .    .   .   .   .   .   . 77.   .
. . . . . . . . . . . . . . .    . . . . . . . . . . . . . . .
. 17. 9 . 8 . 7 . 8 . 6 .12 .    .   .   .   .   .   .   .   .
. . . . . . . . . . . . . . .    . . . . . . . . . . . . . . .
</PRE>

<P>

With the <B>-n</B> <EM>(number)</EM> flag, you get the following result:
<PRE>
Input:                          Output:
  ELEVATION SURFACE               LEAST COST PATH
. . ----- . . . . . . . . . .    . . . . . . . . . . . . . . .
. 20| 19| 17. 16. 17. 16. 16.    .   . 1 . 2 . 3 .   .   .   .
. . |___| . . . . . . . . . .    . . . . . . . . . . . . . . .
. 18. 18. 24. 18. 15. 12. 11.    .   .   .   .   . 4 .   .   .
. . . . . . . . . . . . . . .    . . . . . . . . . . . . . . .
. 22. 16. 16. 18. 10. 10. 10.    .   .   .   .   . 5 .   .   .
. . . . . . . . . . . . . . .    . . . . . . . . . . . . . . .
. 17. 15. 15. 15. 10. 8 . 8 .    .   .   .   .   .   . 6 .   .
. . . . . . . . . . . . . . .    . . . . . . . . . . . . . . .
. 24. 16. 8 . 7 . 8 . 0 .12 .    .   .   .   .   .   . 7 .   .
. . . . . . . . . . . . . . .    . . . . . . . . . . . . . . .
. 17. 9 . 8 . 7 . 8 . 6 .12 .    .   .   .   .   .   .   .   .
. . . . . . . . . . . . . . .    . . . . . . . . . . . . . . .
</PRE>

<P>

<H2>BUGS</H2>

<EM>r.drain</EM> currently finds only the lowest point
(the cell having the smallest category value) in the 
input file that can be reached through directly adjacent cells 
that are less than or equal in value to the cell reached immediately 
prior to it; therefore, it will not necessarily reach the lowest point 
in the input file. It currently finds <EM>pits</EM> in the data, rather 
than the lowest point present. 

<P>

Sometimes, when using an integer cell map and the differences among cell
category values in the <EM><A HREF="r.cost.html">r.cost</A></EM> cumulative
cost surface output are small, this cumulative cost output cannot accurately
be used as input to <EM>r.drain</EM> (<EM>r.drain</EM> will output bad
results).

This problem can be circumvented by making the differences between cell
category values in the cumulative cost output bigger.  It is recommended
that, if the output from <EM><A HREF="r.cost.html">r.cost</A></EM> is to be
used as input to <EM>r.drain</B>,</EM> the user multiply the input cost
surface map to <EM><A HREF="r.cost.html">r.cost</A></EM> by the value of the
map resolution, before running <EM><A HREF="r.cost.html">r.cost</A></EM>.
This can be done using <EM><A HREF="r.mapcalc.html">r.mapcalc</A></EM> or
other programs.  The map resolution can be found using <EM><a href="g.region.html">g.region</A></EM>.

<H2>SEE ALSO</H2>

<EM><A HREF="g.region.html">g.region</A></EM>,
<EM><A HREF="r.cost.html">r.cost</A></EM>,
<EM><A HREF="r.mapcalc.html">r.mapcalc</A></EM>

<H2>AUTHOR</H2>

Completely rewritten by Roger S. Miller, 2001
<P>
July 2004 at WebValley 2004, error checking and vector points added by
Matteo Franchi (Liceo Leonardo Da Vinci, Trento) and
Roberto Flor (ITC-irst, Trento, Italy)

<p><i>Last changed: $Date$</i>
