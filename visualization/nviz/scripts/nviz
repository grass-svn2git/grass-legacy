#!/bin/sh

# the next line restarts using tclsh \
exec $GRASS_TCLSH "$0" "$@"

global env
global argv

#set ENV for script
set NVIZ_SCRIPTS $env(GISBASE)/etc/nviz2.2/scripts

set env(GISDBASE) [exec g.gisenv get=GISDBASE]
set env(LOCATION_NAME) [exec g.gisenv get=LOCATION_NAME]
set env(MAPSET) [exec g.gisenv get=MAPSET]

#Create 3D window (for NVIZ volume support) if needed
set wind3 "$env(GISDBASE)/$env(LOCATION_NAME)/$env(MAPSET)/WIND3"
set default_wind3 "$env(GISDBASE)/$env(LOCATION_NAME)/PERMANENT/DEFAULT_WIND3"

if { [catch {open $wind3 r} fid] && [catch {open $default_wind3 r} fid]} {
    puts "Unable to find 3D window setting (required by NVIZ volume support)" 
    puts "Creating new 3D window based on 2D window and with 3D settings: top=1 bottom=0 dres=1"
          
    eval exec "g3.createwind b=0 t=1 dres=1"
}

#Execute Command
if {$argv == ""} {
#no arguments 
eval exec $env(GISBASE)/etc/nviz2.2/NVWISH2.2 -f $env(GISBASE)/etc/nviz2.2/scripts/nviz2.2_script -name NVIZ >&@stdout
} else {
#pass arguments
eval exec $env(GISBASE)/etc/nviz2.2/NVWISH2.2 -f $env(GISBASE)/etc/nviz2.2/scripts/nviz2.2_script $argv -name NVIZ >&@stdout
}
